<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>AdKira ‚Äì Valida√ß√£o</title>
  <style>
    :root{--primary:#6a5acd;--success:#38a169;--error:#e53e3e;--bg:#f8f9fa;--text:#2d3748;--light:#edf2f7}
    body,html{margin:0;padding:0;height:100%;font-family:'Segoe UI',sans-serif;background:var(--bg);color:var(--text)}
    .splash-screen{position:fixed;inset:0;background:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:99999;animation:fadeOut 1s ease forwards;animation-delay:2.5s}
    .loader{border:6px solid #f3f3f3;border-top:6px solid var(--primary);border-radius:50%;width:60px;height:60px;animation:spin 1s linear infinite;margin-bottom:20px}
    .welcome-text{font-size:1.6em;font-weight:700;opacity:0;transform:translateY(20px);animation:slideIn 1s ease forwards;animation-delay:1.2s}
    @keyframes spin{to{transform:rotate(360deg)}}@keyframes slideIn{to{opacity:1;transform:translateY(0)}}@keyframes fadeOut{to{opacity:0;visibility:hidden}}

    /* Fullscreen scanner */
    #qrFullscreen{position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:9999;display:none;justify-content:center;align-items:center;flex-direction:column}
    #qrFullscreenClose{position:absolute;top:10px;right:10px;background:#fff;border:none;padding:10px;border-radius:6px;cursor:pointer;font-weight:bold;z-index:10000}
    #qrViewFull{width:100vw;height:100vh}

    /* Mensagem central */
    #qrStatus{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:3em;font-weight:700;opacity:0;text-align:center;transition:opacity .25s;text-shadow:0 0 12px rgba(0,0,0,.8)}
    #qrStatus.success{color:var(--success)}
    #qrStatus.error{color:var(--error)}

    /* Estrutura principal */
    main{margin:32px auto;max-width:500px;background:#fff;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,.1);overflow:hidden}
    .tabs{display:flex}.tab{flex:1;padding:14px;text-align:center;background:var(--light);cursor:pointer;font-weight:600;transition:background .3s}.tab.active{background:var(--primary);color:#fff}
    .tabcontent{display:none;padding:24px}.tabcontent.active{display:block}
    input[type=text]{width:100%;padding:12px;font-size:1em;border:1px solid #ccc;border-radius:10px;margin-bottom:14px;text-align:center}
    button{width:100%;padding:12px;font-size:1em;background:var(--primary);color:#fff;border:none;border-radius:10px;cursor:pointer;font-weight:600;box-shadow:0 2px 6px rgba(0,0,0,.1);transition:background .3s}button:hover{background:#5a4ccf}
    .output{margin-top:14px;padding:14px;text-align:center;border-radius:10px;font-size:1.1em}
    .output.success{background:var(--success);color:#fff}.output.error{background:var(--error);color:#fff}
    #guestList{list-style:none;padding:0;margin-top:20px;max-height:300px;overflow-y:auto;border:1px solid #e2e8f0;border-radius:10px;display:none}
    #guestList li{padding:12px 16px;border-bottom:1px solid #edf2f7;display:flex;align-items:center;gap:10px}
    .check{width:20px;height:20px;border-radius:50%;border:2px solid #cbd5e0;flex-shrink:0}.checked{background:var(--success);border-color:var(--success)}
    .footer-note{text-align:center;font-size:.8em;color:#a0aec0;margin:32px 0}
    #progressContainer{margin-top:20px;position:relative;height:26px;background:#e2e8f0;border-radius:13px;overflow:hidden;display:none}
    #progressBar{background:var(--primary);height:100%;width:0%;transition:width .3s}
    #progressText{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:.9em;font-weight:600;color:#fff;text-shadow:0 0 3px rgba(0,0,0,.4)}
  </style>
  <script src="https://unpkg.com/html5-qrcode@latest"></script>
</head>
<body>
  <div class="splash-screen" id="splash"><div class="loader"></div><div class="welcome-text">Bem‚Äëvindo √† AdKira</div></div>

  <div id="qrFullscreen">
    <button id="qrFullscreenClose" onclick="closeFullscreen()">Fechar</button>
    <div id="qrViewFull"></div>
    <div id="qrStatus"></div>
  </div>

  <header ondblclick="secretOverride()">üìã AdKira</header>
  <main>
    <div class="tabs"><div class="tab active" onclick="openTab('cliente')">Cliente</div><div class="tab" onclick="adminLogin()">Admin</div></div>
    <div id="cliente" class="tabcontent active">
      <button onclick="startFullscreenScanner()">üì∑ Escanear QR Code (Tela Cheia)</button>
      <input id="codeInput" type="text" placeholder="Digite o c√≥digo do convite" />
      <button onclick="verify()">Verificar</button>
      <div class="output" id="result">Nenhum c√≥digo validado ainda‚Ä¶</div>
      <div id="progressContainer"><div id="progressBar"></div><span id="progressText"></span></div>
      <ul id="guestList"></ul>
    </div>
    <div id="admin" class="tabcontent">
      <input id="fileInput" type="file" accept=".txt" onchange="importTxt(event)" style="display:none" />
      <div id="adminAddSection" style="display:none">
        <input id="newCode" type="text" placeholder="Novo c√≥digo" />
        <input id="newName" type="text" placeholder="Nome do convidado" />
        <button onclick="addManual()">Adicionar Convidado</button>
      </div>
      <button id="uploadBtn" onclick="document.getElementById('fileInput').click())">üì• Carregar lista (.txt)</button>
      <button id="overrideBtn" onclick="toggleOverride()" style="display:none;margin-top:10px">üõ°Ô∏è Modo Override</button>
    </div>
  </main>
  <div class="footer-note">AdKira ¬© 2025</div>

<script>
let guests={},totalGuests=0,usedGuests=0,override=false;
const PASS='2025Invites',STORAGE_KEY='adkiraEventData';
let fullscreenScanner=null;
window.addEventListener('load',()=>{
  setTimeout(()=>document.getElementById('splash').style.display='none',3500);
  loadState();
  if(localStorage.getItem('keepScanner')==='true') startFullscreenScanner();
});

/* ---------------- estado ---------------- */
function saveState(){localStorage.setItem(STORAGE_KEY,JSON.stringify({guests,totalGuests,usedGuests}));}
function loadState(){
  const d=JSON.parse(localStorage.getItem(STORAGE_KEY)||'{}');
  if(d.guests){
    guests=d.guests;totalGuests=d.totalGuests||0;usedGuests=d.usedGuests||0;
    Object.keys(guests).forEach(c=>addToList(c,guests[c].nome,guests[c].usado));
    if(totalGuests>0) showProgress();
  }
}

/* ---------------- navega√ß√£o ---------------- */
function openTab(t){
  document.querySelectorAll('.tab').forEach(e=>e.classList.remove('active'));
  document.querySelectorAll('.tabcontent').forEach(e=>e.classList.remove('active'));
  document.querySelector(`.tab[onclick*="${t}"]`).classList.add('active');
  document.getElementById(t).classList.add('active');
}
function adminLogin(){
  if(prompt('C√≥digo de administrador:')===PASS){
    openTab('admin');
    document.getElementById('fileInput').style.display='block';
    document.getElementById('adminAddSection').style.display='block';
    document.getElementById('overrideBtn').style.display='block';
  }else alert('C√≥digo incorreto');
}

/* ---------------- verifica√ß√£o ---------------- */
function verify(){
  const code=document.getElementById('codeInput').value.trim();
  if(!code) return flash('DIGITE O C√ìDIGO','error');
  if(!guests[code]) return flash('C√ìDIGO INEXISTENTE','error');
  if(guests[code].usado) return flash('USADO','error',true);
  guests[code].usado=true;usedGuests++;
  flash('PERMITIDO','success',true);
  document.querySelector(`[data-code="${code}"] .check`).classList.add('checked');
  updateProgress();saveState();
  document.getElementById('codeInput').value='';
}
function flash(msg,type,full=false){
  const out=document.getElementById('result');out.textContent=msg;out.className='output '+type;
  if(full){
    const status=document.getElementById('qrStatus');
    status.textContent=msg;status.className=type;status.style.opacity='1';
    setTimeout(()=>status.style.opacity='0',3000);
  }
}

/* ---------------- lista ---------------- */
function addToList(code,nome,usado=false){
  if(document.querySelector(`[data-code="${code}"]`)) return;
  const li=document.createElement('li');li.dataset.code=code;
  li.innerHTML=`<span class="check ${usado?'checked':''}"></span><span>${nome}</span>`;
  document.getElementById('guestList').appendChild(li);
  guests[code]={nome,usado};
}
function showProgress(){
  document.getElementById('guestList').style.display='block';
  document.getElementById('progressContainer').style.display='block';
  updateProgress();
}
function updateProgress(){
  const pct=Math.round((usedGuests/totalGuests)*100);
  document.getElementById('progressBar').style.width=pct+'%';
  document.getElementById('progressText').textContent=`${usedGuests} / ${totalGuests}`;
}

/* ---------------- admin functions ---------------- */
function importTxt(e){
  const file=e.target.files[0];if(!file) return;
  const reader=new FileReader();reader.onload=ev=>{
    guests={};totalGuests=0;usedGuests=0;
    document.getElementById('guestList').innerHTML='';
    ev.target.result.split(/\r?\n/).filter(Boolean).forEach(l=>{
      const [code,name]=l.split(/[,:;\t]+/);
      if(code){addToList(code.trim(),(name||'Convidado').trim());totalGuests++;}
    });
    showProgress();saveState();alert('Lista carregada!');
    e.target.value='';
  };reader.readAsText(file);
}
function addManual(){
  const code=document.getElementById('newCode').value.trim();
  const name=document.getElementById('newName').value.trim();
  if(!code||!name) return alert('Preencha ambos');
  if(guests[code]) return alert('C√≥digo j√° existe');
  addToList(code,name);totalGuests++;
  showProgress();saveState();
}

/* ---------------- override ---------------- */
function secretOverride(){ if(prompt('Senha de emerg√™ncia:')===PASS){override=true;alert('Override ativo');} }
function toggleOverride(){ override=!override;alert('Override '+(override?'ativo':'desativado')); }

/* ---------------- scanner ---------------- */
function startFullscreenScanner(){
  document.getElementById('qrFullscreen').style.display='flex';
  localStorage.setItem('keepScanner','true');
  fullscreenScanner=new Html5Qrcode('qrViewFull');
  fullscreenScanner.start({facingMode:'environment'},{fps:10,qrbox:300},
    txt=>{document.getElementById('codeInput').value=txt;verify();},
    ()=>{});
}
function closeFullscreen(){
  if(fullscreenScanner){
    fullscreenScanner.stop().then(()=>fullscreenScanner.clear()).then(()=>fullscreenScanner=null);
  }
  document.getElementById('qrFullscreen').style.display='none';
  localStorage.removeItem('keepScanner');
  document.getElementById('qrStatus').style.opacity='0';
}
</script>
</body>
</html>
