<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AdKira – Gerador de Convites + QR</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f4f4f4;padding:20px;max-width:900px;margin:auto}
    h1{text-align:center;color:#5c67f2}
    textarea{width:100%;height:150px;padding:10px;font-size:1em;margin-bottom:10px}
    input,select,button{padding:10px;font-size:1em;margin-bottom:10px;width:100%;box-sizing:border-box}
    #output{white-space:pre;background:#fff;padding:15px;border:1px solid #ccc;border-radius:8px;margin-top:15px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:16px;margin-top:20px}
    .qr-box{background:#fff;padding:10px;border:1px solid #ddd;border-radius:10px;text-align:center;box-shadow:0 2px 6px rgba(0,0,0,.05)}
    .qr-box canvas{width:120px;height:120px}
    .row{display:flex;gap:10px}
  </style>
  <!-- biblioteca QRCode.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
  <h1>🔐 AdKira – Gerador de Convites + QR</h1>
  <label for="names">Nomes dos convidados (um por linha):</label>
  <textarea id="names" placeholder="Ex: Maria João\nCarlos Alberto\n...\n"></textarea>

  <div class="row">
    <input type="text" id="prefix" placeholder="Prefixo do código (opcional)" />
    <input type="number" id="length" placeholder="Dígitos (ex: 3 = 001)" min="1" value="3" />
  </div>

  <button onclick="generateList()">Gerar Lista & QR</button>
  <button onclick="downloadTXT()">📥 Baixar .txt</button>
  <button onclick="downloadQRPngs()">📦 Baixar QR como .zip</button>
  <button onclick="copyToClipboard()">📋 Copiar Lista</button>
  <button onclick="clearAll()">🧹 Limpar Tudo</button>

  <div id="counter"></div>
  <div id="output"></div>
  <section id="qrContainer" class="grid"></section>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
<script>
let listData="";
function generateList(){
  const names=document.getElementById('names').value.trim().split(/\r?\n/).filter(Boolean);
  const prefix=document.getElementById('prefix').value.trim();
  const digits=parseInt(document.getElementById('length').value);
  const used=new Set();
  let out="",counter=1;
  const qrWrap=document.getElementById('qrContainer');qrWrap.innerHTML='';
  names.forEach(name=>{
    let code=String(counter).padStart(digits,'0');
    if(prefix)code=prefix+code;
    while(used.has(code)){counter++;code=String(counter).padStart(digits,'0');if(prefix)code=prefix+code;}
    used.add(code);
    out+=`${code},${name}\n`;
    // cria QR
    const box=document.createElement('div');box.className='qr-box';
    const canvas=document.createElement('div');box.appendChild(canvas);
    const label=document.createElement('div');label.textContent=code;label.style.marginTop='6px';label.style.fontSize='0.8em';box.appendChild(label);
    qrWrap.appendChild(box);
    new QRCode(canvas,{text:code,width:120,height:120});
    counter++;
  });
  listData=out.trim();
  document.getElementById('output').textContent=listData;
  document.getElementById('counter').textContent=`Total: ${names.length} convidados.`;
}
function downloadTXT(){if(!listData)return alert('Gere a lista primeiro.');const blob=new Blob([listData],{type:'text/plain'});const link=document.createElement('a');link.href=URL.createObjectURL(blob);link.download='lista_convidados.txt';link.click();}
function copyToClipboard(){if(!listData)return alert('Gere a lista primeiro.');navigator.clipboard.writeText(listData).then(()=>alert('Lista copiada!'));}
function clearAll(){document.getElementById('names').value='';document.getElementById('output').textContent='';document.getElementById('counter').textContent='';document.getElementById('qrContainer').innerHTML='';listData='';}
async function downloadQRPngs(){const boxes=document.querySelectorAll('.qr-box canvas');if(!boxes.length)return alert('Gere os QR primeiro.');const zip=new JSZip();let i=1;boxes.forEach(cv=>{const data=cv.toDataURL('image/png').split(',')[1];zip.file(`qr_${i}.png`,data,{base64:true});i++;});const blob=await zip.generateAsync({type:'blob'});const link=document.createElement('a');link.href=URL.createObjectURL(blob);link.download='qr_codes.zip';link.click();}
</script>
</body>
</html>
