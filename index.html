<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>InvitesQR Final</title>
  <script src="https://unpkg.com/html5-qrcode@latest">
function verificarOnline() {
  const offline = !navigator.onLine;
  document.getElementById("offlineOverlay").style.display = offline ? "flex" : "none";
}
window.addEventListener('online', verificarOnline);
window.addEventListener('offline', verificarOnline);




function abrirAba(aba) {
  // Scanner
  document.getElementById("scannerContainer").style.display = (aba === 'scanner') ? 'block' : 'none';

  // Lista
  const listaVisivel = (aba === 'lista');
  document.getElementById("guestList").style.display = listaVisivel ? 'block' : 'none';
  document.getElementById("result").style.display = listaVisivel ? 'block' : 'none';
  document.getElementById("searchInput").style.display = listaVisivel ? 'block' : 'none';
  document.querySelector("button[onclick='carregarConvidados()']").style.display = listaVisivel ? 'inline-block' : 'none';
  document.querySelector("button[onclick='baixarCSV()']").style.display = listaVisivel ? 'inline-block' : 'none';
  document.getElementById("progressBar").style.display = listaVisivel ? 'block' : 'none';

  // Info
  const infoVisivel = (aba === 'info');
  document.getElementById("validadeMsg").style.display = infoVisivel ? 'block' : 'none';
  document.getElementById("doneMsg").style.display = infoVisivel ? 'block' : 'none';
}



const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
document.body.classList.toggle("dark", prefersDark);

function alternarTema() {
  document.body.classList.toggle("dark");
}


window.addEventListener("load", () => {
  setTimeout(() => {
    const splash = document.getElementById("splashScreen");
    if (splash) splash.remove();
  }, 2000);
});



async function verificarConexaoReal() {
  try {
    const res = await fetch("https://rnvunprjvppbjavkaoek.supabase.co/rest/v1/clientes?select=id&limit=1", {
      headers: {
        apikey: SUPABASE_KEY,
        Authorization: `Bearer ${SUPABASE_KEY}`
      }
    });
    return res.ok;
  } catch {
    return false;
  }
}

async function atualizarEstadoConexao() {
  const online = await verificarConexaoReal();
  document.getElementById("offlineOverlay").style.display = online ? "none" : "flex";
}

setInterval(atualizarEstadoConexao, 5000);
atualizarEstadoConexao();

atualizarEstadoConexao();

</script>
  <style>
    body { margin: 0; background: #121212; color: white; font-family: sans-serif; text-align: center; }
    input, button { padding: 14px; border-radius: 10px; border: none; margin: 10px 0; width: 90%; max-width: 400px; font-size: 1em; }
    input { background: #1f1f1f; color: white; }
    button { background: #6a5acd; color: white; }
    button:hover { background: #5a4ccf; }
    #qr-reader { width: 100%; max-width: 400px; margin: 10px auto; display: none; }
    ul { list-style: none; padding: 0; max-width: 400px; margin: auto; text-align: left; }
    li { padding: 10px; border-bottom: 1px solid #333; font-size: 1em; }
    #whatsapp { position: fixed; bottom: 20px; right: 20px; background: #25d366; color: white; padding: 12px 14px; border-radius: 50%; font-size: 20px; text-decoration: none; z-index: 999; }
    #modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); color: white; font-size: 1.5em; justify-content: center; align-items: center; z-index: 9999; text-align: center; padding: 20px; }
    progress { width: 90%; height: 14px; border-radius: 8px; background: #444; overflow: hidden; }
    progress::-webkit-progress-value { background: #6a5acd; }
    #offline { display: none; background: #e53e3e; color: white; padding: 10px; font-weight: bold; }
    #scannerContainer { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:10000; }
    #scanFeedback { height:20%; color:white; font-size:1.5em; display:flex; align-items:center; justify-content:center; }
  </style>

<style>
  body.dark { background: #121212; color: white; }
  body:not(.dark) { background: #f0f0f0; color: black; }
</style>
<button onclick="alternarTema()" style="position:fixed;top:10px;left:10px;z-index:1000;">üåì</button>

</head>
<body>

<div id="splashScreen" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#121212;display:flex;align-items:center;justify-content:center;z-index:9999;">
  <div style="width:160px;height:160px;border-radius:50%;padding:8px;background:conic-gradient(from 0deg, #6a5acd, #00ffff, #6a5acd);animation:spin 2s linear infinite;">
    <div style="width:100%;height:100%;border-radius:50%;background:white;display:flex;align-items:center;justify-content:center;">
      <img src="data:image/png;base64,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" alt="Logo" style="width:90%;height:90%;border-radius:50%;" />
    </div>
  </div>
</div>

<style>
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>

<style>
  body.dark { background: #121212; color: white; }
  body:not(.dark) { background: #f0f0f0; color: black; }
  input, button, progress { transition: all 0.3s ease; }
  body.dark input { background: #1f1f1f; color: white; }
  body:not(.dark) input { background: #ffffff; color: black; }
  body.dark button { background: #6a5acd; color: white; }
  body:not(.dark) button { background: #6a5acd; color: white; }
  body.dark #bottomNav { background: #1e1e1e; }
  body:not(.dark) #bottomNav { background: #ddd; }
</style>


  <div id="offline">‚ö†Ô∏è Sem conex√£o com a internet</div>
  <h1 id="clienteNome">InvitesQR</h1>
  <p style="font-size: 1.1em; color: #ccc;">Entre em contacto connosco pelo <strong>959 823 409</strong></p>
  
<p style="font-size: 1.05em; color: #ccc; padding: 0 10px;">üëã Bem-vindo ao <strong>InvitesQR</strong>, sua solu√ß√£o moderna de controlo de acesso por QR Code.</p>
<p style="font-size: 1em; color: #aaa;">
  Entre em contacto connosco pelo <strong>959 823 409</strong> para saber mais ou testar uma demonstra√ß√£o.
</p>

<input id="tokenInput" type="text" placeholder="Digite o token do cliente" />
  <button onclick="iniciar(document.getElementById('tokenInput').value)">Entrar</button>
  <div id="app" style="display:none;">

<div id="bottomNav" style="position:fixed;bottom:0;left:0;width:100%;background:#1e1e1e;display:flex;justify-content:space-around;padding:10px 0;z-index:999;">
  <button onclick="abrirAba('scanner')">üì∑ Scanner</button>
  <button onclick="abrirAba('lista')">üìã Lista</button>
  <button onclick="abrirAba('info')">‚öôÔ∏è Info</button>
</div>

    <div id="validadeMsg"></div>
    <button onclick="startScanner()">üì∑ Escanear QR Code</button>
    <div id="scannerContainer">
      <div id="qr-reader" style="width:100%; height:80%;"></div>
      <div id="scanFeedback"></div>
      <button onclick="fecharScanner()" style="position:absolute;top:10px;right:10px;background:red;color:white;padding:10px;border-radius:8px;">‚ùå Fechar</button>
    </div>
    <div id="result">Nenhum convidado validado ainda</div>
    <input id="searchInput" type="text" placeholder="üîç Pesquisar convidado" oninput="filtrarConvidados()" />
    <button onclick="carregarConvidados()">üîÑ Recarregar Lista</button>
    <button onclick="baixarCSV()">üì• Exportar CSV</button>
    <progress id="progressBar" max="100" value="0"></progress>
    <ul id="guestList"></ul>
    
<div id="sobreNos" style="margin-top: 20px; font-size: 0.95em; color: #bbb;">
  <p><strong>InvitesQR</strong> ajuda no controlo digital de convidados com valida√ß√£o r√°pida via QR Code.</p>
</div>
<div id="doneMsg" style="display:none;color:#00e676;margin-top:20px;">üéâ Todos os convidados foram validados!</div>
  </div>
  <div id="modal" onclick="this.style.display='none'"></div>
  

<script>
const SUPABASE_URL = "https://rnvunprjvppbjavkaoek.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJudnVucHJqdnBwYmphdmthb2VrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE2NjYzOTksImV4cCI6MjA2NzI0MjM5OX0.5E37Qm-KMmyGtGKbOINbDqMQlZlfgcQx91RQ01qslT8";

let scanner = null;
let permitirSom = false;
let token = localStorage.getItem('token');
let deviceId = localStorage.getItem('device_id') || crypto.randomUUID();
localStorage.setItem('device_id', deviceId);
let client = null, convidados = [];

let tentativasInvalidas = 0;
let bloqueadoAte = 0;


function vibrar() { if (navigator.vibrate) navigator.vibrate(200); }
function exibirFeedbackScanner(texto, cor) {
  const fb = document.getElementById("scanFeedback");
  fb.innerText = texto;
  fb.style.background = cor;
}

function startScanner() {
  document.getElementById("scannerContainer").style.display = "block";
  if (!scanner) scanner = new Html5Qrcode("qr-reader");

  let ultimoId = null;
  scanner.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, async content => {
    const match = convidados.find(c => c.id.toString() === content.trim());
    if (!match) return exibirFeedbackScanner("‚ùå N√£o encontrado", "#a00");

    if (match.status === "usado") {
      exibirFeedbackScanner("‚ö†Ô∏è Usado", "#aa8800");
      vibrar();
      return;
    }

    if (match.id === ultimoId) return;
    ultimoId = match.id;
    await marcarComoUsado(match.id);
    await incrementarScans();
    exibirFeedbackScanner("‚úîÔ∏è Permitido", "#007f00");
    vibrar();
    
  const diasRestantes = Math.floor((client.validade * 1000 - Date.now()) / (1000 * 60 * 60 * 24));
  if (diasRestantes <= 2) {
    alert("‚ö†Ô∏è Sua licen√ßa expira em breve.");
  }

  await carregarConvidados();

    if (client.scans_usados >= client.limite_scans) {
      await scanner.stop(); document.getElementById("scannerContainer").style.display = "none";
      alert("‚ö†Ô∏è Limite atingido.");
    }
  }, console.warn);
}

function fecharScanner() {
  document.getElementById("scannerContainer").style.display = "none";
  if (scanner) scanner.stop();
}

function exibirModal(msg) {
  const m = document.getElementById("modal");
  m.innerText = msg; m.style.display = "flex"; vibrar();
}

window.addEventListener('online', () => document.getElementById("offline").style.display = "none");
window.addEventListener('offline', () => document.getElementById("offline").style.display = "block");
if (!navigator.onLine) document.getElementById("offline").style.display = "block";

async function iniciar(inputToken) {

  const agora = Date.now();
  if (agora < bloqueadoAte) {
    alert("‚õî Muitas tentativas inv√°lidas. Tente novamente em alguns segundos.");
    return;
  }

  document.body.innerHTML += '<div id="loadingOverlay" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#000a;color:white;font-size:1.5em;display:flex;justify-content:center;align-items:center;z-index:9999;">üîê Validando seu acesso...</div>';
  token = inputToken || token;
  const res = await fetch(`${SUPABASE_URL}/rest/v1/clientes?token=eq.${token}`, {
    headers: { apikey: SUPABASE_KEY, Authorization: `Bearer ${SUPABASE_KEY}` }
  });
  const data = await res.json();
  client = data[0];
  
  if (!client) {
    tentativasInvalidas++;
    if (tentativasInvalidas >= 3) {
      bloqueadoAte = Date.now() + 60000;
      alert("‚õî Muitas tentativas inv√°lidas. Aguarde 1 minuto.");
    } else {
      alert("‚ùå Token inv√°lido.");
    }
    document.getElementById("loadingOverlay").remove();
    return;
  }

  if (client.dispositivos && client.dispositivos !== deviceId) return alert("‚ùå Token j√° usado em outro dispositivo.");
  if (client.validade * 1000 < Date.now()) return alert("‚è∞ Token expirado.");
  if (client.scans_usados >= client.limite_scans) return alert("‚ö†Ô∏è Limite atingido.");
  if (!client.dispositivos) {
    await fetch(`${SUPABASE_URL}/rest/v1/clientes?token=eq.${token}`, {
      method: "PATCH", headers: { apikey: SUPABASE_KEY, Authorization: `Bearer ${SUPABASE_KEY}`, "Content-Type": "application/json" },
      
      body: JSON.stringify({ dispositivos: `${deviceId} | ${navigator.userAgent}` })

    });
  }
  localStorage.setItem('token', token);
  
  document.getElementById("loadingOverlay").remove();
  tentativasInvalidas = 0;
  document.getElementById("tokenInput").style.display = "none";

  document.querySelector("button[onclick^='iniciar']").style.display = "none";
  document.getElementById("app").style.display = "block";
  document.getElementById("clienteNome").innerText = `üéâ Ol√°, ${client.nome}`;
  document.getElementById("validadeMsg").innerText = `‚è≥ V√°lido at√©: ${new Date(client.validade * 1000).toLocaleDateString()}`;
  
  const diasRestantes = Math.floor((client.validade * 1000 - Date.now()) / (1000 * 60 * 60 * 24));
  if (diasRestantes <= 2) {
    alert("‚ö†Ô∏è Sua licen√ßa expira em breve.");
  }

  await carregarConvidados();
}

async function carregarConvidados() {
  const res = await fetch(`${SUPABASE_URL}/rest/v1/convidados?token_cliente=eq.${token}`, {
    headers: { apikey: SUPABASE_KEY, Authorization: `Bearer ${SUPABASE_KEY}` }
  });
  convidados = await res.json();
  renderConvidados();
}

function renderConvidados() {
  const list = document.getElementById("guestList");
  const query = document.getElementById("searchInput").value.toLowerCase();
  let usados = 0;
  list.innerHTML = "";
  convidados.filter(c => c.nome.toLowerCase().includes(query)).forEach(c => {
    if (c.status === "usado") usados++;
    const li = document.createElement("li");
    li.innerText = `${c.status === 'usado' ? '‚úÖ' : 'üü¢'} ${c.nome}`;
    list.appendChild(li);
  });
  const pct = convidados.length ? (usados / convidados.length) * 100 : 0;
  document.getElementById("progressBar").value = pct;
  document.getElementById("result").innerText = `${usados}/${convidados.length} validados`;
  if (usados === convidados.length && convidados.length > 0) document.getElementById("doneMsg").style.display = "block";
}

function filtrarConvidados() { renderConvidados(); }

async function marcarComoUsado(id) {
  await fetch(`${SUPABASE_URL}/rest/v1/convidados?id=eq.${id}`, {
    method: "PATCH", headers: { apikey: SUPABASE_KEY, Authorization: `Bearer ${SUPABASE_KEY}`, "Content-Type": "application/json" },
    body: JSON.stringify({ status: "usado" })
  });
}

async function incrementarScans() {
  await fetch(`${SUPABASE_URL}/rest/v1/clientes?token=eq.${token}`, {
    method: "PATCH", headers: { apikey: SUPABASE_KEY, Authorization: `Bearer ${SUPABASE_KEY}`, "Content-Type": "application/json" },
    body: JSON.stringify({ scans_usados: client.scans_usados + 1 })
  });
  client.scans_usados++;
}

function baixarCSV() {
  if (!convidados.length) return alert("Nenhum convidado carregado.");
  const linhas = ["Nome,Status", ...convidados.map(c => `"${c.nome}","${c.status}"`)];
  const blob = new Blob([linhas.join("\n")], { type: "text/csv" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download = "convidados.csv"; document.body.appendChild(a); a.click(); document.body.removeChild(a);
}

setInterval(() => { if (token) carregarConvidados(); }, 30000);

setInterval(async () => {
  if (!token) return;
  const res = await fetch(`${SUPABASE_URL}/rest/v1/clientes?token=eq.${token}`, {
    headers: { apikey: SUPABASE_KEY, Authorization: `Bearer ${SUPABASE_KEY}` }
  });
  const data = await res.json();
  if (data.length === 0) {
    alert("‚ùå Sua conta foi desativada. Por favor, contacte a Invites.");
    localStorage.clear();
    location.reload();
  }
}, 30000);


function verificarOnline() {
  const offline = !navigator.onLine;
  document.getElementById("offlineOverlay").style.display = offline ? "flex" : "none";
}
window.addEventListener('online', verificarOnline);
window.addEventListener('offline', verificarOnline);




function abrirAba(aba) {
  // Scanner
  document.getElementById("scannerContainer").style.display = (aba === 'scanner') ? 'block' : 'none';

  // Lista
  const listaVisivel = (aba === 'lista');
  document.getElementById("guestList").style.display = listaVisivel ? 'block' : 'none';
  document.getElementById("result").style.display = listaVisivel ? 'block' : 'none';
  document.getElementById("searchInput").style.display = listaVisivel ? 'block' : 'none';
  document.querySelector("button[onclick='carregarConvidados()']").style.display = listaVisivel ? 'inline-block' : 'none';
  document.querySelector("button[onclick='baixarCSV()']").style.display = listaVisivel ? 'inline-block' : 'none';
  document.getElementById("progressBar").style.display = listaVisivel ? 'block' : 'none';

  // Info
  const infoVisivel = (aba === 'info');
  document.getElementById("validadeMsg").style.display = infoVisivel ? 'block' : 'none';
  document.getElementById("doneMsg").style.display = infoVisivel ? 'block' : 'none';
}



const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
document.body.classList.toggle("dark", prefersDark);

function alternarTema() {
  document.body.classList.toggle("dark");
}


window.addEventListener("load", () => {
  setTimeout(() => {
    const splash = document.getElementById("splashScreen");
    if (splash) splash.remove();
  }, 2000);
});



async function verificarConexaoReal() {
  try {
    const res = await fetch("https://rnvunprjvppbjavkaoek.supabase.co/rest/v1/clientes?select=id&limit=1", {
      headers: {
        apikey: SUPABASE_KEY,
        Authorization: `Bearer ${SUPABASE_KEY}`
      }
    });
    return res.ok;
  } catch {
    return false;
  }
}

async function atualizarEstadoConexao() {
  const online = await verificarConexaoReal();
  document.getElementById("offlineOverlay").style.display = online ? "none" : "flex";
}

setInterval(atualizarEstadoConexao, 5000);
atualizarEstadoConexao();

atualizarEstadoConexao();

</script>

<div id="offlineOverlay" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:#000e;color:#fff;z-index:10000;font-size:1.2em;display:flex;align-items:center;justify-content:center;">
‚ö†Ô∏è Sem conex√£o. Conecte-se para continuar.
</div>

</body>
</html>
